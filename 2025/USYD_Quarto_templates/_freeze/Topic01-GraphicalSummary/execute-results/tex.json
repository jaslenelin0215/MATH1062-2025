{
  "hash": "bdf77128ba37277cbc8c586b19251ead",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Exploring Data\nsubtitle: Data & Graphical Summaries\nauthor:\n  - name: MATH1062\n    affiliations: The University of Sydney\nembed-resources: true # embed resources into single HTML file -- enable when ready to publish\n# NOTE: please check _quarto.yml file for more options\nhtml-math-method: mathjax\nformat:\n  pdf:\n    toc: true\n    number-sections: true\n    colorlinks: true\n---\n\n::: {.cell}\n\n:::\n\n\n\n:::: {.content-visible when-format=\"html\"}\n## Module 1 Exploring Data \n\n### Data & Graphical Summaries \nWhat type of data do we have & how can we visualise it?\n\n### Numerical Summaries \nWhat are the main features of the data?\n\n## Outline\n\n### [Initial data analysis](#4)\n### [Identifying variables](#5) \n### [Graphical summaries](#6) \n\n- [Barplot](#7) \n- [Histogram](#8) \n- [Other graphical summaries](#9)\n\n### [Logical operators](#10)\n### [A research question (next week)](#11) \n\n::::\n\n\\newpage\n\n# Data story \nWhat causes Australian road fatalities?\n\n:::: {.content-visible when-format=\"html\"}\n\n##\n\n::::\n\nWe are going to investigate <i class=\"fa fa-link\"></i>\n[data from the Australian Bureau of Statistics (ABS)](https://data.gov.au/dataset/ds-dga-5b530fb8-526e-4fbf-b0f6-aa24e84e4277) (last updated Nov 2023)\n\n![](figure/RoadFatalityDataViz2.jpg){fig-align=\"center\"}\n\n<i class=\"fa fa-link\"></i>\n[ABC Animation](http://www.abc.net.au/news/2018-01-25/every-road-death-in-australia-since-1989/9353794)\n\n:::: {.content-visible when-format=\"pdf\"}\n\n\\newpage\n\n::::\n\n## Variables\n    \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Read in data\ndata = read.csv(\"data/2023fatalities.csv\", header=TRUE)\n# Names of Variables\nnames(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Crash.ID\"                      \"State\"                        \n [3] \"Month\"                         \"Year\"                         \n [5] \"Dayweek\"                       \"Time\"                         \n [7] \"Crash.Type\"                    \"Bus.Involvement\"              \n [9] \"Heavy.Rigid.Truck.Involvement\" \"Articulated.Truck.Involvement\"\n[11] \"Speed.Limit\"                   \"Road.User\"                    \n[13] \"Gender\"                        \"Age\"                          \n[15] \"National.Remoteness.Areas\"     \"SA4.Name.2021\"                \n[17] \"National.LGA.Name.2021\"        \"National.Road.Type\"           \n[19] \"Christmas.Period\"              \"Easter.Period\"                \n[21] \"Age.Group\"                     \"Day.of.week\"                  \n[23] \"Time.of.day\"                   \"X\"                            \n```\n\n\n:::\n:::\n\n\n    \n<i class=\"fa fa-link\"></i> [Data dictionary](https://data.gov.au/data/dataset/5b530fb8-526e-4fbf-b0f6-aa24e84e4277/resource/59055fed-d4f1-4a81-b3ee-75cb438009c6/download/ardd_dictionary.pdf)\n\n## Statistical Thinking\n\nPossible research questions:\n\n- How many road fatalities have there been so far this year, and how does it compare to last year?\n- What is the most common day and time for a crash?\n- Does gender affect the type of road fatality?\n- What is the chance that a motorcycle rider is involved in a road fatality? \n- How many people [wear seatbelts](https://infrastructure.gov.au/roads/safety/publications/1980/pdf/Belt_Analysis_1.pdf)?\n\n:::: {.content-visible when-format=\"pdf\"}\n\n\\newpage\n\n::::\n\n# Initial data analysis\n\n## Initial data analysis (IDA)\n\nData is **information** about the set of **subjects** being studied (like road fatalities). Most commonly, data refers to the **sample**, not the population.\n  \n**Initial data analysis** is a first general look at the data, without formally answering the research questions.\n\n- IDA helps you to see whether the data can answer your research questions. \n- IDA may lead to new research questions.\n- IDA can\n    - identify the data's main qualities;  \n    - suggest the population from which a sample derives.\n\n## What's involved in IDA?\n\nInitial Data Analysis commonly involves:\n\n- data background: checking the quality and integrity of the data\n- data structure: what information has been collected?\n- data wrangling: scraping, cleaning, tidying, \nreshaping, splitting, combining\n- data summaries: graphical and numerical\n\nHere we focus on **structure** & **graphical summaries** for qualitative and quantitative data.\n\n\n# Structure of the data\n\n:::: {.content-visible when-format=\"pdf\"}\n## Data Formats\n\nThere are many different types of data, in different formats.\n\nFor example:\n\n- [survey data](https://www.monash.edu/__data/assets/pdf_file/0019/217423/muarc288.pdf)\n- spreadsheet type data\n- MRI image data\n\n<div align=\"center\">\n<img src=\"figure/MRIknee.jpg\" width=\"20%\" height=\"20%\">\n</div>\n\n::::\n\n## Variables \n\nA **variable** measures or describes some attribute of the subjects. \n\n- Data with $p$ variables is said to have **dimension** $p$. \n\n<div style=\"margin-top: 35px\"></div>\n\nHow many variables does the road fatality data have?\n\n- The road fatality data has dimension $p=23$, as the CrashID serves as an anonymous identifier.\n\n<div style=\"margin-top: 35px\"></div>\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Size of Data (rows and columns)\ndim(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 55360    24\n```\n\n\n:::\n:::\n\n\n\n:::: {.content-visible when-format=\"pdf\"}\n\n## Number of variables\n\n![](images/img1.1.png){fig-align=\"center\"}\n\n::::\n\n## Types of variables \n\n![](images/img1.2.png){fig-align=\"center\"}\n\n\n## Statistical Thinking\n\nClassify the variable `Age` in the Road Fatality Data.\n\n- Technically Age is a quantitative, continuous variable, but here the ages have been reported as discrete 'integer' (by rounding down to the nearest year). \n\n- Age may be also be recorded as a qualitative variable in a survey, as respondents may be more willing to give their age category. (e.g. 18-24)\n\n- However, it is more precise to record quantitative data if possible.\n\n\\newpage\n\n## Change variable types in R\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Structure of Data (tells us how each variable is stored in R)\nstr(data, vec.len=2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t55360 obs. of  24 variables:\n $ Crash.ID                     : int  20237008 20234009 20233087 20233149 20233190 ...\n $ State                        : chr  \"NT\" \"SA\" ...\n $ Month                        : int  10 10 10 10 10 ...\n $ Year                         : int  2023 2023 2023 2023 2023 ...\n $ Dayweek                      : chr  \"Friday\" \"Saturday\" ...\n $ Time                         : chr  \"\" \"03:00\" ...\n $ Crash.Type                   : chr  \"Single\" \"Single\" ...\n $ Bus.Involvement              : chr  \"No\" \"No\" ...\n $ Heavy.Rigid.Truck.Involvement: chr  \"No\" \"No\" ...\n $ Articulated.Truck.Involvement: chr  \"No\" \"No\" ...\n $ Speed.Limit                  : chr  \"-9\" \"100\" ...\n $ Road.User                    : chr  \"Driver\" \"Driver\" ...\n $ Gender                       : chr  \"Female\" \"Male\" ...\n $ Age                          : int  24 22 19 37 35 ...\n $ National.Remoteness.Areas    : chr  \"\" \"Outer Regional Australia\" ...\n $ SA4.Name.2021                : chr  \"\" \"Barossa - Yorke - Mid North\" ...\n $ National.LGA.Name.2021       : chr  \"\" \"Yorke Peninsula\" ...\n $ National.Road.Type           : chr  \"\" \"Local Road\" ...\n $ Christmas.Period             : chr  \"No\" \"No\" ...\n $ Easter.Period                : chr  \"No\" \"No\" ...\n $ Age.Group                    : chr  \"17_to_25\" \"17_to_25\" ...\n $ Day.of.week                  : chr  \"Weekend\" \"Weekend\" ...\n $ Time.of.day                  : chr  \"Night\" \"Night\" ...\n $ X                            : logi  NA NA NA ...\n```\n\n\n:::\n:::\n\n\n\n## Change variable types in R\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Change qualitative variables stored as \"numeric\" to \"factors\"\ndata$Crash.ID=as.factor(data$Crash.ID)\ndata$Month=as.factor(data$Month)\n```\n:::\n\n\n\n:::: {.content-visible when-format=\"pdf\"}\n\n\\newpage\n\n::::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# New structure of Data\n# Display the first 5 variables using list.len=5\nstr(data, list.len=5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t55360 obs. of  24 variables:\n $ Crash.ID                     : Factor w/ 49903 levels \"19891001\",\"19891002\",..: 49880 49646 49506 49568 49609 49471 49805 49849 49568 49872 ...\n $ State                        : chr  \"NT\" \"SA\" \"Qld\" \"Qld\" ...\n $ Month                        : Factor w/ 12 levels \"1\",\"2\",\"3\",\"4\",..: 10 10 10 10 10 10 10 10 10 10 ...\n $ Year                         : int  2023 2023 2023 2023 2023 2023 2023 2023 2023 2023 ...\n $ Dayweek                      : chr  \"Friday\" \"Saturday\" \"Saturday\" \"Sunday\" ...\n  [list output truncated]\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Change quantitative variables stored as \"characters\" to \"numeric\"\ndata$Speed.Limit=as.numeric(data$Speed.Limit)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# New structure of Data\n# Display variables 11 to 15\nstr(data[c(11,12,13,14,15)])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t55360 obs. of  5 variables:\n $ Speed.Limit              : num  -9 100 80 60 100 70 60 80 60 60 ...\n $ Road.User                : chr  \"Driver\" \"Driver\" \"Driver\" \"Passenger\" ...\n $ Gender                   : chr  \"Female\" \"Male\" \"Male\" \"Male\" ...\n $ Age                      : int  24 22 19 37 35 32 29 51 39 33 ...\n $ National.Remoteness.Areas: chr  \"\" \"Outer Regional Australia\" \"Inner Regional Australia\" \"Inner Regional Australia\" ...\n```\n\n\n:::\n:::\n\n\n\n# Graphical summaries \n\n## Graphical summaries\n\nOnce we've identified the variables, we can summarise the data, both graphically and numerically, in order to identify and highlight the main features of interest. \n\nWe often start with graphical summaries because ‘A (well-designed) picture is worth a thousand words.’ \n\nE.g. I didn't finish reading the “Lord of the Ring” books, but the movies are graphical summary the contents of the books. Yes, the specific details are omitted, but the movies told the same meaningful story in lesser time (11 hours vs 455,000 words.)\n\n## Choosing a graphical summary \n\nHow to choose an appropriate graphical summary?\n\n- The critical question is: ‘What plot is the more informative?’ or ‘What plot will best highlight features of the data?’ or ‘What plot will best guide the next analysis?’.\n\n- To some extent we use trial and error. We try some standard forms and see what is revealed about the data. One graphical summary can suggest another, and often a combination will highlight different features of the data\n\n- In practice we use computer packages like R to construct summaries.\n\n- However, it is important to understand how to construct graphical summaries ‘by hand’, so that you understand how to interpret computer output and for your final exam.\n\n# Graphical summaries\n\n:::: {.content-visible when-format=\"html\"}\n\nBarplot (qualitative data)\n\n::::\n\n## Barplot (qualitative data) \n\n**Question:** What was the most common day of road fatality? \n\n<div style=\"margin-top: -15px\"></div>\n\nStep 1: Build a frequency table\n\n<div style=\"margin-top: -15px\"></div>\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Select the DayWeek variable from the whole data frame\nDayweek = data$Dayweek\n# Produce a frequency table of fatalities per day of the week\ntable(Dayweek) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDayweek\n   Friday    Monday  Saturday    Sunday  Thursday   Tuesday Wednesday \n     9094      6382     10107      8855      7456      6483      6983 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Order days\nDayweek=factor(Dayweek,levels= c(\"Monday\", \"Tuesday\",\"Wednesday\", \"Thursday\", \n                                 \"Friday\", \"Saturday\", \"Sunday\"))\ntable(Dayweek) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDayweek\n   Monday   Tuesday Wednesday  Thursday    Friday  Saturday    Sunday \n     6382      6483      6983      7456      9094     10107      8855 \n```\n\n\n:::\n:::\n\n\n\n##\n\nStep 2: Produce a barplot\n\n\n::: {.cell}\n\n:::\n\n::: {.cell outwidth='120%'}\n\n```{.r .cell-code}\n# Produce a barplot\nbarplot(table(Dayweek), col = mycols, main = \"Fatalities by Day of the Week\", \n        ylab = \"Fatalities\", xlab = \"Day of the week\")\n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-10-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n## Statistical Thinking\n\nWhat was the most common day of road fatality? \n\n- Saturday\n\nWhy might that be the case?\n\n- More volume of cars on the road, or people driving faster?\n\nWhat data would you need to check your hypotheses?\n\n- Data on volume and speed of cars on the road each day.\n\n\\newpage\n\n## Double barplot\n\nThings get more interesting when we consider 2 qualitative variables.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Select Gender variable\nGender = data$Gender\n\n# Produce a double frequency table (contingency table)\ndata1 = table(Gender, Dayweek)\ndata1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             Dayweek\nGender        Monday Tuesday Wednesday Thursday Friday Saturday Sunday\n  -9               3       2        12        3     10        6      2\n  Female        1945    2034      2135     2094   2538     2555   2325\n  M                0       0         1        0      0        0      0\n  Male          4433    4447      4835     5359   6545     7541   6528\n  U                1       0         0        0      1        4      0\n  Unspecified      0       0         0        0      0        1      0\n```\n\n\n:::\n:::\n\n\n\nNote: Here Gender refers to biological sex as it was historically recorded in this dataset. [Read more](https://www.abs.gov.au/ausstats/abs@.nsf/Lookup/by%20Subject/2071.0~2016~Main%20Features~Sex%20and%20Gender%20Diversity%20in%20the%202016%20Census~100).\n\n\\newpage\n\n## Stacked barplot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbarplot(data1, main=\"Fatalities by Day of the Week and Gender\",\n  xlab=\"Day of the week\", ylab = \"Fatalities\", col=c('red',\"lightblue\",\"lightgreen\",'orange', \"purple\", \"pink\"),\n \tlegend = rownames(data1))\n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-12-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\\newpage\n\n## Side-by-side barplot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbarplot(data1, main=\"Fatalities by Day of the Week and Gender\",\n  xlab=\"Day of the week\", ylab = \"Fatalities\", col=c('red',\"lightblue\",\"lightgreen\",'orange', \"purple\", \"pink\"),\n \tlegend = rownames(data1), beside=TRUE)\n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-13-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\\newpage\n\n## Side-by-side barplot ignoring '-9', 'M', 'U' and 'Unspecified'\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbarplot(data1[-c(1,3,5,6),], main=\"Fatalities by Day of the Week and Gender\",\n  xlab=\"Day of the week\", ylab = \"Fatalities\", col=c(\"lightblue\",\"orange\"),\n \tlegend = rownames(data1[-c(1,3,5,6),]), beside=TRUE,\n  args.legend = list(x = \"topright\"))\n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-14-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n## Statistical Thinking\n\nAre these plots telling us anything useful? How could they be misread?\n\n- There seems to be a similar proportion of gender fatalities across each day.\n- We could posit that men are more likely to be involved in fatal accidents than women. However, perhaps there are more men on the road than women. More data is needed.\n\n\\newpage\n\n# Graphical summaries\n\n:::: {.content-visible when-format=\"html\"}\n\nHistogram (quantitative data)\n\n::::\n\n## Histogram \n\nThe frequency table can also be used to summarise a set of **quantitative** data, by collecting the data into **class intervals** (or ‘bins’). A histogram highlights the frequency of data in one class interval compared to another.\n\nThis is the default histogram generated by R for Age of Road Fatalities .\n\n\n\n::: {.cell outwidth='90%'}\n\n```{.r .cell-code}\nhist(data$Age, xlab=\"Age\", ylab=\"Frequency\",\n     main=\"Histogram for Age of Road Fatalities\")  \n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-15-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\\newpage\n\n##\n\nWe can also provide user-defined class intervals and the **density scale**.\n\n**Q:** What were the most common age groups at which a road fatality occurred?\n\n\n\n\n::: {.cell outwidth='90%'}\n\n```{.r .cell-code}\n# Select the variable Age\nAge = data$Age\n\n# Define end points for class intervals\nbreaks=c(-10,18,25,70,101)\n\n# Build frequency table\ntable(cut(Age,breaks,right=F))  \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n[-10,18)  [18,25)  [25,70) [70,101) \n    5747    11541    30566     7504 \n```\n\n\n:::\n:::\n\n\n\n:::: {.content-visible when-format=\"pdf\"}\n\n##\n\n**Q:** What proportion of total road fatalities does each age group account for?\n\n\n\n::: {.cell outwidth='120%'}\n\n```{.r .cell-code}\n# Convert the frequency table into densities\ntable(cut(Age,breaks,right=F))/length(Age)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n [-10,18)   [18,25)   [25,70)  [70,101) \n0.1038114 0.2084718 0.5521315 0.1355491 \n```\n\n\n:::\n:::\n\n\n\n::::\n\n\\newpage\n\n## Histogram for Age of Road Fatalities in Australia 1989-2023\n\n\n\n::: {.cell outwidth='90%'}\n\n```{.r .cell-code}\nhist(Age,br=breaks,right=F,freq=F,\n     xlab=\"Age (years)\", ylab=\"Density\",\n     main=\"Histogram for Age of Road Fatalities in Australia 1989-2023\")  \n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-18-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n<div style=\"margin-top: -35px\"></div>\n\n  - The horizontal scale is divided into **class intervals** with potentially unequal sizes.\n  - The **area of each block** represents the **proportion** of subjects in that particular class interval.\n\n## Data cleaning \n\nWhy does the 1st block start below 0?\n\n- <i class=\"fa fa-link\"></i> [Data Dictionary](https://data.gov.au/data/dataset/5b530fb8-526e-4fbf-b0f6-aa24e84e4277/resource/59055fed-d4f1-4a81-b3ee-75cb438009c6/download/ardd_dictionary.pdf):  missing values are coded as '-9'.\n\n\n<div align=\"center\">\n<img src=\"figure/excelNA.png\" width=\"50%\" height=\"50%\">\n</div>\n\n- It is better to replace the \"-9\" by \"NA\". \n\n## Removing Missing Values\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Replacing the \"-9\" entries\ndata$Age[data$Age==-9] = NA   \n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell outwidth='90%'}\n\n```{.r .cell-code}\nhist(data$Age,br=breaks,freq=F,right=F,\n     xlab=\"Age\",  ylab=\"Density\",\n     main=\"Histogram for Age of Road Fatalities in Australia 1989-2023\") \n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-21-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n<div style=\"margin-top: -35px\"></div>\n\nHow can we interpret this histogram?\n\n- Why is the histogram tallest above [18,25)?\n- Which age group have overall most fatalities? (should be [25,70), as it has the largest area)\n\n## Details of density-scale histograms\n\n**1.**  We will mostly use the **density scale** instead of frequency scale. We will see why when looking at common mistakes.\n\n### Density scale\n\nThe area of the whole histogram on the density scale is one (or, in percentage, 100\\%).\n\n$$\\mbox{area (proportion) of each block} = \\frac{ \\mbox{number of subjects in the class interval}}{\\mbox{total number of subjects}}$$\n\n$$\\mbox{height (density) of each block} = \\frac{ \\mbox{proportion of the block}}{\\mbox{length of the class interval}} \\hspace{36pt}$$\n\n## Class Endpoints\n\n**2.** For continuous (quantitative) data, we need an **endpoint convention** for data points that fall on the border of two class intervals.\n\n- If an interval contains the left endpoint but excludes the right endpoint, then an 18 year old would be counted in [18,25) not [0,18).\n- We call this left-closed and right-open.\n- Similarly, we can also have left-open and right-closed, e.g., (18,25].\n\n\\newpage\n\n##\n\n**3.** Number of class intervals\n\nThink about how many class intervals (or the sizes of class intervals) you want to have.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(1,2))  # This puts the graphic output in 1 row with 2 columns\nbreaks=seq(0,102,2) # This sets the breaks to be every 2 numbers\nhist(Age,br=breaks,freq=F,right=F,\n     xlab=\"Age\", ylab='Density')\nbreaks=c(0,18,25,70,101)\nhist(Age,br=breaks,freq=F,right=F,\n     xlab=\"Age\",ylab='Density')\n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-22-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n## Produce a histogram by hand\n\n### Step 1: Construct the distribution table.\n\n|Class intervals|Number of subjects in the interval|%| Height of block|\n|---|---|---|---|\n|[0,18)|5747|10.4|0.0058|\n|[18,25)|11541|20.8|0.0298|\n|[25,70)|30566|55.2|0.0123|\n|[70,101)|7504|13.6|0.0044|\n||55360|100| \n\n<br>\nwhere Height of block = % per year.\n\n## Step 2: Draw the horizontal axis and blocks.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-23-1.pdf)\n:::\n:::\n\n\n\n## The speedy way in R\n\n\n\n::: {.cell outwidth='80%'}\n\n```{.r .cell-code}\n#Read in data\ndata = read.csv(\"data/2023Fatalities.csv\",header=T)\n\n# Cleaning\ndata$Age[data$Age==-9] = NA   \n\n# Choose a variable\nAge = data$Age\n\n# Choose the class intervals\nbreaks=c(0,18,25,70,101)\n\n# Produce a histogram\nhist(Age,br=breaks,freq=F,right=F,\n     xlab=\"Age (in years)\", ylab=\"Density\",\n     main=\"Histogram for Age of Road Fatalities in Australia 1989-2020\")  \n```\n:::\n\n\n\nNote: \n\n- `freq=F` produces the histogram on the density scale.  \n- `right=F` makes the intervals right-open. \n\n## Controlling for a variable\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nAgeF = data$Age[data$Gender==\"Female\"]   # This selects just the female ages.\nAgeM = data$Age[data$Gender==\"Male\"]\npar(mfrow=c(1,2))  # This puts the graphic output in 1 row with 2 columns\nhist(AgeF,freq = F)\nhist(AgeM,freq = F)\n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-25-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n<i class=\"fa fa-comment-alt\"></i>\nDo you notice any differences between men and women?\n\n## Mistake 1: The block heights are equal to the percentages\n\n- Here we wrongly use the **percentage** (or the **total number** of subjects in a class interval) as the heights.\n- Unless the class intervals are the same size, in both cases this will makes larger class intervals look like a larger overall %. \n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-26-1.pdf)\n:::\n:::\n\n\n\nSolution: Use density as the height, especially if class intervals are **not** the same size. Don't use percentage or total numbers.\n\n## Mistake 2: Using too many or too few class intervals\n\nThis can hide the true pattern in the data. As a rule of thumb, use between 10-15 class intervals and make sure you consider the size of the data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nAge_reduced = Age[1:1000]  # only look at subset of data\npar(mfrow = c(1,3))\nhist(Age_reduced,breaks=3)\nhist(Age_reduced,breaks=10)\nhist(Age_reduced,breaks=50)  \n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-27-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n# Other graphical summaries\n\n## Scatter plot\n\nThe scatter plot examines the relationship between two quantitative variables. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nYear = data$Year\nplot(Age, Year)\n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-28-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n<div style=\"margin-top: -45px\"></div>\n\nThere have been fatalities for nearly every combination... so it is hard to say whether there is a relationship between Age and Year in fatalities. \n\n## Heatmap\nA heatmap might be a good choice here.\nA heatmap is especially useful when a contingency table is not practical due to too many different values.\n\nHeatmaps use colour to display the relative frequency for each value. In the graph below we can see darker colours for earlier years and for ages closer to 18 which suggests a higher frequency of fatalities around this points.\n\n<div style=\"margin-top: 15px\"></div>\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nheatmap(table(Age, Year), Rowv=NA, Colv=NA, scale='none', \n        main='Heatmap of frequencies')\n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-29-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n## Boxplot \n\n- The boxplot plots the five number summary of a data set. That is, the median ('middle' data point), the middle 50% of the data in a box, the expected maximum and minimum in the whiskers, and determines any outliers.\n- We will consider how to draw the box plot when we learn about the interquartile range (IQR) in a later lecture.\n\n\n\n::: {.cell outwidth='20%'}\n\n```{.r .cell-code}\nAge = data$Age\nsummary(Age)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n   0.00   22.00   35.00   39.99   56.00  101.00     116 \n```\n\n\n:::\n:::\n\n\n\n<div style=\"margin-top: 15px\"></div>\n\n<div align=\"left\">\n<img src=\"figure/dacheng5.1.png\" width=\"30%\" height=\"30%\">\n</div>\n\n## Boxplot in R\n\n\n::: {.cell outwidth='20%'}\n\n```{.r .cell-code}\npar(mfrow=c(1,2))\nboxplot(Age) # We can plot the box plot vertically\nboxplot(Age, horizontal=T) # Or horizontally\n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-31-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n## Statistical Thinking\n\nWhat does the simple boxplot reveal about the age of fatalities?\n\n- The box plot is fairly symmetric with no outliers.\n- There does not seem to be any extreme ages for fatalities.\n\n## Comparative box plots\n\nA comparative boxplot splits up a quantitative variable by a qualitative variable.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGender = data$Gender\n# Select each of the data entries in Age if the corresponding data entry \n# in Gender is Female\nsummary(Age[Gender==\"Female\"]) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n   0.00   22.00   40.00   43.37   64.00  101.00      32 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Select each of the data entries in Age if the corresponding data entry \n# in Gender is Female\nsummary(Age[Gender==\"Male\"])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n   0.00   22.00   33.00   38.69   52.00  101.00      60 \n```\n\n\n:::\n:::\n\n\n\nHere `Age` and `Gender` must have the same number of data points. \n\n## Comparing by Gender\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filtering the gender variable to only include \"female\" and \"male\" values\ndata$Gender = factor(data$Gender, levels= c(\"Female\", \"Male\"))\n\n# Selecting the gender variable\nGender = data$Gender\n\nboxplot(Age~Gender, horizontal = T)\n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-33-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\nThe median ('middle') age is fairly similar but higher for women than for men.\n\n\n# Logical operators\n\n## Basics of logical operators\n\nThe basic logical values in R are `TRUE` (or just `T`) and `FALSE` (or just `F`). These come up very often in R when you are checking an object, or comparing an object to a value or another object, as in $x > 5$ or $x > y$.\n\nSome commonly used logical operators:\n\n||||||\n|---|---|-|---|---|\n| `>` | greater than || `>=` | greater than or equal to |\n| `<` | less than || `<=` | less than or equal to |\n| `==` | equal to || `!=` | not equal to |\n||||||\n\n<div style=\"margin-top: 10px\"></div>\n\nMany of these are exactly what you would expect (like `>`) but remember to use **two** equal signs rather than one when assessing equality (`==` not `=`). If you use just one equal sign, R thinks you are trying to assign a value to an object.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx = 5   # This assigns the value 5 to x\nx == 5  # This checks to see if x equals 5\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n:::\n\n\n\n## Combining logical conditions\n\nYou can combine logical conditions using `&` (and), `|` (or), and `!` (not).\n\nThe evaluation of `&` (and): both conditions need to be `TRUE` to have a `TRUE`\n\n|`&`|True|False|\n|---|---|---|\n| True  | True  | False |\n| False | False | False |\n||||\n\n<div style=\"margin-top: 10px\"></div>\n\nExamples:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx = 10\nis.numeric(x) & x < 20 # True and True\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nx = 10\nis.numeric(x) & x < 0 # True and False\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] FALSE\n```\n\n\n:::\n:::\n\n\n\n\\newpage\n\n## \n\nThe evaluation of `|` (or): need to have at least one of the conditions to be `TRUE` to give a `TRUE` evaluation\n\n|`|`|True|False|\n|---|---|---|\n| True  | True  | True |\n| False | True | False |\n||||\n\n<div style=\"margin-top: 10px\"></div>\n\nExamples:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx = 10\n!is.numeric(x) | x < 20 # False and True\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nx = 10\nis.character(x) & x < 0 # False and False\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] FALSE\n```\n\n\n:::\n:::\n\n\n\n## Data selection and counting\n\nYou can apply logical operators elementwise to vectors or matrices. This can be particularly useful for data selection and counting.\n\n<div style=\"margin-top: -5px\"></div>\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx = c(-1, 0, 1)\n# Check each element of x against the condition (elementwise)\nx <= 0          \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1]  TRUE  TRUE FALSE\n```\n\n\n:::\n:::\n\n\n<div style=\"margin-top: 20px\"></div>\n\n\\newpage\n\n`TRUE` and `FALSE` in R also correspond to integers `1` (`TRUE`) and `0` (`FALSE`). This way, they are also useful for counting. For example, how many data points of $x$ in the following case are less than 5?\n\n<div style=\"margin-top: -5px\"></div>\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx = 1:10\n# Check each element of x against the condition (elementwise)\nx <= 5\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE\n```\n\n\n:::\n\n```{.r .cell-code}\nsum(x <= 5) # sum over those TRUEs (data points <= 5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 5\n```\n\n\n:::\n:::\n\n\n\n##\nExample on data selection\n\n<div style=\"margin-top: -5px\"></div>\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# creating a data frame\nrating = 1:5\nanimal = c('koala', 'hedgehog', 'sloth', 'panda', 'alligator')\ncountry = c('Australia', 'Italy', 'Peru', 'China', \"USA\")\navg_sleep_hours = c(21, 18, 17, 10, 15)\nsleepers = data.frame(rating, animal, country, avg_sleep_hours)\nstr(sleepers)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t5 obs. of  4 variables:\n $ rating         : int  1 2 3 4 5\n $ animal         : chr  \"koala\" \"hedgehog\" \"sloth\" \"panda\" ...\n $ country        : chr  \"Australia\" \"Italy\" \"Peru\" \"China\" ...\n $ avg_sleep_hours: num  21 18 17 10 15\n```\n\n\n:::\n:::\n\n\n\n\\newpage\n\n##\n\nQ1: Filter `sleepers` data with rating less than 3\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsleepers1 = sleepers[sleepers$rating<3, ]\ndim(sleepers1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 2 4\n```\n\n\n:::\n\n```{.r .cell-code}\nstr(sleepers1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t2 obs. of  4 variables:\n $ rating         : int  1 2\n $ animal         : chr  \"koala\" \"hedgehog\"\n $ country        : chr  \"Australia\" \"Italy\"\n $ avg_sleep_hours: num  21 18\n```\n\n\n:::\n:::\n\n\n\nQ2: Filter `sleepers` data with rating more than 3 and sleeping hour more than 15\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsleepers2 = sleepers[sleepers$rating>3 & sleepers$avg_sleep_hours>15, ]\ndim(sleepers2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0 4\n```\n\n\n:::\n\n```{.r .cell-code}\nstr(sleepers2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t0 obs. of  4 variables:\n $ rating         : int \n $ animal         : chr \n $ country        : chr \n $ avg_sleep_hours: num \n```\n\n\n:::\n:::\n\n\n\n\\newpage\n\n# Research question\n\n## Statistical Thinking:\n\nConsider the road fatalities data set. \n<div style=\"margin-top: 5px\"></div>\n\n1. How can we quantify the risk of each age group?\n<div style=\"margin-top: -5px\"></div>\n2. Which variables in our data might be useful? \n<div style=\"margin-top: -5px\"></div>\n3. Do we need additional data? What kind of data?\n<div style=\"margin-top: -5px\"></div>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Crash.ID\"                      \"State\"                        \n [3] \"Month\"                         \"Year\"                         \n [5] \"Dayweek\"                       \"Time\"                         \n [7] \"Crash.Type\"                    \"Bus.Involvement\"              \n [9] \"Heavy.Rigid.Truck.Involvement\" \"Articulated.Truck.Involvement\"\n[11] \"Speed.Limit\"                   \"Road.User\"                    \n[13] \"Gender\"                        \"Age\"                          \n[15] \"National.Remoteness.Areas\"     \"SA4.Name.2021\"                \n[17] \"National.LGA.Name.2021\"        \"National.Road.Type\"           \n[19] \"Christmas.Period\"              \"Easter.Period\"                \n[21] \"Age.Group\"                     \"Day.of.week\"                  \n[23] \"Time.of.day\"                   \"X\"                            \n```\n\n\n:::\n:::\n\n\n\n## Strategy:\n- Only count those deaths where the person is the driver.\n- Find driving licence data with age information.\n- Combine information and derive a death rate per driving licence for different age groups.\n\n\\newpage\n\n## 1) Only count those deaths where the person is the driver\n\n:::: {.content-visible when-format=\"html\"}\n\n### What is the definition of `Road.User`?\n\n::::\n\n:::: {.content-visible when-format=\"pdf\"}\n\nWhat is the definition of `Road.User`?\n\n::::\n\n![](figure/road_user.jpg){fig-align=\"center\"}\n\n:::: {.content-visible when-format=\"html\"}\n\n## 1) Only count those deaths where the person is the driver\n\n::::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata.driver = data[data$Road.User=='Driver',]\nAge.driver = data.driver$Age\nbreaks = c(0,18,25,70,101)\n# Produce a histogram\nhist(Age.driver,br=breaks,freq=F,right=F,\n     xlab=\"Age (in years)\", ylab=\"Density\",\n     main=\"Age of Road Fatalities of drivers in Australia 1989-2020\")  \n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-45-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n## 2) Find driving licences data with ages\n\n### South Australia provides this information.\n<i class=\"fa fa-link\"></i>\n[data.gov.au](https://data.gov.au/dataset/ds-sa-baf6bbfa-e04f-424f-8c92-9d302425634a/details)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Driver's licence data for SA Q4 2023\nlicence.sa = read.csv(\"data/drivers-licences-by-postcode-age-and-sex-q4-2023.csv\", header=T)\nstr(licence.sa)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t45975 obs. of  4 variables:\n $ PostCode: chr  \"0870\" \"0870\" \"0870\" \"0870\" ...\n $ Age     : int  19 21 23 24 24 25 26 26 27 28 ...\n $ Sex     : chr  \"Female\" \"Male\" \"Male\" \"Female\" ...\n $ Total   : chr  \"1\" \"2\" \"1\" \"2\" ...\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert data type of Total to numeric\nlicence.sa$Total = as.numeric(licence.sa$Total)\n```\n:::\n\n\n\n## Pooled data\nPut ages into categories using `cut`. \n<div style=\"margin-top: 0px\"></div>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbreaks = c(0,18,25,70,101)\nlicence.sa$Age = cut(licence.sa$Age,breaks,right=F)\nhead(licence.sa)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  PostCode     Age    Sex Total\n1     0870 [18,25) Female     1\n2     0870 [18,25)   Male     2\n3     0870 [18,25)   Male     1\n4     0870 [18,25) Female     2\n5     0870 [18,25)   Male     1\n6     0870 [25,70)   Male     1\n```\n\n\n:::\n:::\n\n\n\n<div style=\"margin-top: 10px\"></div>\n\n\\newpage\n\nPool the data for each age category using `aggregate`. \n<div style=\"margin-top: 0px\"></div>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlicence.sa.pooled = aggregate(Total ~ Age, sum, data=licence.sa)\nhead(licence.sa.pooled)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       Age  Total\n1   [0,18)  33079\n2  [18,25) 132769\n3  [25,70) 976368\n4 [70,101) 204619\n```\n\n\n:::\n:::\n\n\n\n## Plot the data with a barplot\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nTotal = licence.sa.pooled$Total\nbarplot(Total, names.arg=licence.sa.pooled$Age, \n        ylab='Number of drivers licences in 2023', ylim = c(0, 1000000))\n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-51-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\\newpage\n\n## Re-visit Step 1) \n\n- We should filter the road deaths data for **South Australia** and for **drivers**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata.sa = data[data$State==\"SA\"&data$Road.User=='Driver', ]\ndim(data.sa)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 2226   24\n```\n\n\n:::\n:::\n\n\n\n<div style=\"margin-top: 10px\"></div>\n\n- We have 2226 observed deaths. Plot the histogram of the ages of those fatalities.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(data.sa$Age,br=breaks,freq=F,right=F,\n     xlab=\"Age (in years)\", ylab=\"Density\",\n     main=\"Histogram for Age of Road Fatalities of Drivers in SA\")  \n```\n\n::: {.cell-output-display}\n![](Topic01-GraphicalSummary_files/figure-pdf/unnamed-chunk-53-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\\newpage\n\n## \n\n- Pool the data for different age groups.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(data.sa$Age)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 22 86 54 36 24 53\n```\n\n\n:::\n\n```{.r .cell-code}\ndata.sa$Age = cut(data.sa$Age,breaks,right=F)\nhead(data.sa$Age)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] [18,25)  [70,101) [25,70)  [25,70)  [18,25)  [25,70) \nLevels: [0,18) [18,25) [25,70) [70,101)\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata.sa.pooled = table(data.sa$Age)\ndata.sa.pooled\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  [0,18)  [18,25)  [25,70) [70,101) \n      84      481     1312      347 \n```\n\n\n:::\n:::\n\n\n\n\n## 3) Derive death rates for different age groups.\n\nGet death rate per 10,000 licences:\n$$\n\\\n\\text{death rate per 10000} = 10000  \\times \\frac{\\text{number of deaths}}{\\text{number of licences}}\n\\\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndeath.rate = 10000 * data.sa.pooled/licence.sa.pooled$Total\ndeath.rate\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  [0,18)  [18,25)  [25,70) [70,101) \n25.39375 36.22834 13.43756 16.95835 \n```\n\n\n:::\n:::\n\n\n\n### Conclusion: \nDeath rate per licence for age group [18,25) is the highest, approximately three times higher than the death rate for age group [25,70)\n\n:::: {.content-visible when-format=\"html\"}\n\n## Summary\n\n### [Identifying variables](#5) \n\n### [Graphical summaries](#7) \n\n- [Barplot](#7) \n- [Histogram](#8)\n- [Scatter plot](#9)\n- [Boxplot](#9) \n\n### [Logical operators](#10)\n\n### Some useful R Functions\n`names`, `dim`, `str`, `table`, `barplot`, `hist`, `plot`, `boxplot`, `as.factor`, `as.numeric`, `cut`, `sum`\n\n### Logical operators\n`<`, `<=`, `>`, `>=`, `==`, `!=`, `&`, `|`, `!`\n\n::::\n",
    "supporting": [
      "Topic01-GraphicalSummary_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}